<!DOCTYPE html>
<html>
<head>
    <title>Simple Mouse Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        #status { padding: 10px; margin: 10px 0; }
        .connected { background: #4CAF50; color: white; }
        .disconnected { background: #f44336; color: white; }
    </style>
</head>
<body>
    <h1>Simple Mouse Tracker Test</h1>
    <div id="status" class="disconnected">Connecting...</div>
    <div id="coords">Move your mouse!</div>
    <div id="log"></div>

    <script>
        const statusEl = document.getElementById('status');
        const coordsEl = document.getElementById('coords');
        const logEl = document.getElementById('log');

        function log(msg) {
            console.log(msg);
            const line = document.createElement('div');
            line.textContent = new Date().toLocaleTimeString() + ': ' + msg;
            logEl.prepend(line);
        }

        const ws = new WebSocket('ws://localhost:9090');

        ws.onopen = function() {
            statusEl.textContent = 'âœ… WebSocket Connected';
            statusEl.className = 'status connected';
            log('WebSocket connected successfully');
        };

        ws.onerror = function(err) {
            statusEl.textContent = 'âŒ WebSocket Error';
            statusEl.className = 'status disconnected';
            log('WebSocket error: ' + JSON.stringify(err));
        };

        ws.onclose = function() {
            statusEl.textContent = 'ðŸ”Œ WebSocket Disconnected';
            statusEl.className = 'status disconnected';
            log('WebSocket closed');
        };

        // Track mouse movements
        let lastSent = 0;
        const throttleMs = 50;

        document.addEventListener('mousemove', function(e) {
            const now = Date.now();
            coordsEl.textContent = `Mouse: x=${e.clientX}, y=${e.clientY}`;

            if (now - lastSent > throttleMs && ws.readyState === WebSocket.OPEN) {
                const data = {x: e.clientX, y: e.clientY};
                ws.send(JSON.stringify(data));
                log('Sent: ' + JSON.stringify(data));
                lastSent = now;
            }
        });
    </script>
</body>
</html>
